<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title></title>
    <script type='text/javascript' src="http://d3js.org/d3.v3.min.js"></script>
    <script type='text/javascript' src="http://micropolar.org/micropolar-v0.2.2.js"></script>
    <link href="nouislider.min.css" rel="stylesheet">
    <style>

    .chart {display: inline;}

    </style>
</head>
<body>

  <div id="drag-fixed"></div>
  <div id="table"> </div>
  <div class="chart" id="chart-sub-polar1"></div>
  <div class="chart" id="chart-sub-polar2"></div>

  <h3>Move slider handle to select a point from sum current chart. Phasor chart updates with associated timestamp and info table for values</h3>



  <script src="nouislider.min.js"></script>
  <script>
  // dummy data for timestamps
  var timestamps = ["05-20-2016",
                    "05-21-2016",
                    "05-22-2016",
                    "05-23-2016",
                    "05-24-2016",
                    "05-25-2016",
                    "05-26-2016",
                    "05-27-2016",
                    "05-28-2016",
                    "05-29-2016",
                    "05-30-2016"
                  ];
  var tValues = [118, 119, 117, 120, 121, 124, 125, 130, 129, 108, 121];
  var rValues = [9, 12, 15, 10, 8, 7, 8, 10, 9, 10, 11];

  // slider
  dragFixedSlider = document.getElementById('drag-fixed');
  noUiSlider.create(dragFixedSlider, {
  	start: [ 6 ],
    step: 1,
  	range: {
  		'min':  0,
  		'max':  10
  	},
    pips: {
  	mode: 'steps',
  	density: 7
  }
  });

  // slider update function
  dragFixedSlider.noUiSlider.on('update', function(){

    var sliderMax = this["options"]["range"]["max"];
    var sliderMin = this["options"]["range"]["min"];
    var sliderValue = parseInt(this.get());

    var tableContent = "Slider interval: " + sliderValue + " Timestamp: " + timestamps[sliderValue] +
    " // IR: " + tValues[sliderValue] + " r1: " + rValues[sliderValue] +
    " // IS: " + tValues[sliderValue] + " r2: " + rValues[sliderValue] +
    " // IT: " + tValues[sliderValue] + " r3: " + rValues[sliderValue] ;
    document.getElementById('table').innerHTML = tableContent

    var tSelected = tValues[sliderValue];
    var rSelected = rValues[sliderValue];

    if (sliderValue === sliderMax) {
      var latestColor = "green";
    } else {
      var latestColor = "orange";
    }

    console.log("slider update fire");
    console.log(this.get());
    console.log("Slider max: " + sliderMax);
    console.log("Slider min: " + sliderMin);
    console.log("Slider value: " + sliderValue);

    function getRandomIntBetweenRange(min, max) {
      return Math.floor(Math.random() * (max - min) + min);
    }

    var trand = [getRandomIntBetweenRange(100, 140), getRandomIntBetweenRange(0, 10), getRandomIntBetweenRange(210, 250)]
    var rrand = [getRandomIntBetweenRange(8, 12), getRandomIntBetweenRange(8, 12), getRandomIntBetweenRange(11, 16)]
    var colors = ["green"]

    // phasor chart
    var polarTwoConfig = {
      "data": [
      {
        "t": [tValues[sliderValue], tValues[sliderValue] - 120, tValues[sliderValue] + 120],
        "r": [rValues[sliderValue], rValues[sliderValue], rValues[sliderValue]],
        "name": "Current Vectors",
        "visible": true,
        "color": "green",
        "geometry": "DotPlot",
      }],
      "layout": {
        "radialAxis": {
          "domain": [0,20],
          "orientation": -45,
          "visible": true,
          "gridLinesVisible": true,
          "tickOrientation": 'horizontal',
          "ticksSuffix": "mA"
        },
        "angularAxis": {
          "domain": [0,360],
          "visible": true,
          "gridLinesVisible": true,
          "labelsVisible": true,
          "tickOrientation": "horizontal",
          "ticksSuffix": "째"
        },
        "labelOffset": 15,
        "direction": "counterclockwise",
      },

    };

    // sum current chart
    var polarOneConfig = {
      "data": [
      // data for sum current cloud
      {
        "t": tValues,
        "r": rValues,
        "name": "Current Sum",
        "visible": true,
        "color": "blue",
        "geometry": "DotPlot",
      },
      //data for selected point
      {
        "t": [tSelected],
        "r": [rSelected],
        "name": "Selected Point",
        "visible": true,
        "color": "green",
        "geometry": "DotPlot",
      },
      //data for most recent point
      {
        "t": [tValues[sliderMax]],
        "r": [rValues[sliderMax]],
        "name": "Latest Value",
        "visible": true,
        "color": latestColor,
        "geometry": "DotPlot",
      }],
      "layout": {
        "radialAxis": {
          "domain": [0,20],
          "orientation": -45,
          "visible": true,
          "gridLinesVisible": true,
          "tickOrientation": 'horizontal',
          "ticksSuffix": "mA"
        },
        "angularAxis": {
          "domain": [0,360],
          "visible": true,
          "gridLinesVisible": true,
          "labelsVisible": true,
          "tickOrientation": "horizontal",
          "ticksSuffix": "째"
        },
        "labelOffset": 15,
        "direction": "counterclockwise",
      },
    };

    //rendering both here
    micropolar.Axis()
      .config(polarTwoConfig)
      .render(d3.select('#chart-sub-polar2'))
    micropolar.Axis()
      .config(polarOneConfig)
      .render(d3.select('#chart-sub-polar1'));

  });



  </script>

  <script>
  // setting original values - NEEDS WORK, COULD JUST PUT IN FIRST FUNCTION
  var config = {
    "data": [
    // data for sum current cloud
    {
      "t": tValues,
      "r": rValues,
      "name": "Current Sum",
      "visible": true,
      "color": "blue",
      "geometry": "DotPlot",
    },
    //data for selected point
    {
      "t": [tValues[6]],
      "r": [rValues[6]],
      "name": "Selected Point",
      "visible": true,
      "color": "green",
      "geometry": "DotPlot",
    },
    //data for most recent point
    {
      "t": [tValues[10]],
      "r": [rValues[10]],
      "name": "Latest Value",
      "visible": true,
      "color": "orange",
      "geometry": "DotPlot",
    }],
    "layout": {
      "radialAxis": {
        "domain": [0,20],
        "orientation": -45,
        "visible": true,
        "gridLinesVisible": true,
        "tickOrientation": 'horizontal',
        "ticksSuffix": "mA"
      },
      "angularAxis": {
        "domain": [0,360],
        "visible": true,
        "gridLinesVisible": true,
        "labelsVisible": true,
        "tickOrientation": "horizontal",
        "ticksSuffix": "째"
      },
      "labelOffset": 15,
      "direction": "counterclockwise",
    },
  };
  micropolar.Axis()
    .config(config)
    .render(d3.select('#chart-sub-polar1'));
  </script>

  <script>
  // setting original phasor values - also needs work, same as above
  var t = [125, 1, 240]
  var r = [8, 8, 8]
  var config = {
    "data": [
    {
      "t": t,
      "r": r,
      "name": "Current Vectors",
      "visible": true,
      "color": "green",
      "geometry": "DotPlot",
    }],
    "layout": {
      "radialAxis": {
        "domain": [0,20],
        "orientation": -45,
        "visible": true,
        "gridLinesVisible": true,
        "tickOrientation": 'horizontal',
        "ticksSuffix": "mA"
      },
      "angularAxis": {
        "domain": [0,360],
        "visible": true,
        "gridLinesVisible": true,
        "labelsVisible": true,
        "tickOrientation": "horizontal",
        "ticksSuffix": "째"
      },
      "labelOffset": 15,
      "direction": "counterclockwise",
    },

  };
  micropolar.Axis()
    .config(config)
    .render(d3.select('#chart-sub-polar2'));
  </script>

</body>
</html>
